"use strict";var googleMap={}||googleMap,google=google,titleCssClass="titles",timesCssClass="times",MapStyle=[{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21}]},{featureType:"road",elementType:"geometry",stylers:[{saturation:"14"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:17}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:29},{weight:.2}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.local",elementType:"geometry",stylers:[{lightness:"4"},{color:"#a92a2a"},{saturation:"-31"},{gamma:"0.67"},{weight:"1.19"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#151526"},{lightness:17}]}];googleMap.mapSetup=function(){$(".bob").on("click",googleMap.getCurrentLocation);var e=document.getElementById("map-canvas"),t={zoom:13,center:new google.maps.LatLng(51.50364,(-.127625)),mapTypeId:google.maps.MapTypeId.ROADMAP,styles:MapStyle,mapTypeControl:!1};googleMap.map=new google.maps.Map(e,t)},googleMap.getCurrentLocation=function(){navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),map:googleMap.map,animation:google.maps.Animation.DROP}),googleMap.getCinemas(t)})},googleMap.getCinemas=function(e){$.get("http://localhost:3000/api/cinemas/"+e.lat+"/"+e.lng).done(googleMap.getLatLng)},googleMap.getLatLng=function(e){console.log("running"),$.each(e,function(e,t){var o=t.name.split(",")[0];o.indexOf("-")===-1&&$.get("http://localhost:3000/api/cinemas/"+o).done(function(e){e||alert("No cinemas nearby, see ya later you dirty animal!"),t.formattedAddress=e.results[0].formatted_address,t.rating=e.results[0].rating,t.lat=e.results[0].geometry.location.lat,t.lng=e.results[0].geometry.location.lng,googleMap.createMarkerForCinemas(t)})})},googleMap.createMarkerForCinemas=function(e){var t=new google.maps.LatLng(e.lat,e.lng);new google.maps.Marker({position:t,map:googleMap.map,icon:"/images/marker.png"})},googleMap.addInfoWindowForCamera=function(e,t){google.maps.event.addListener(t,"click",function(){console.log("clicked"),googleMap.getListings(e)})},googleMap.getListings=function(e,t){console.log("listings"),$.get("https://api.cinelist.co.uk/get/times/cinema/"+e.id).done(function(o){return googleMap.getTitlesAndTimes(o,e,t)})},googleMap.getTitlesAndTimes=function(e,t,o){var l="";$.each(e.listings,function(e,t){var o=t.listings[e].times.join(", ");l+="<li class = "+titleCssClass+">"+t.listings[e].title+":</li><li class = "+timesCssClass+">"+o+"</li>"}),"undefined"!=typeof this.infoWindow&&this.infoWindow.close(),this.infoWindow=new google.maps.InfoWindow({content:"<h3>"+t.formattedAddress+"</h3><ul>"+l+"</ul>"}),this.infoWindow.open(this.map,o),console.log(e)},$(googleMap.mapSetup.bind(googleMap));
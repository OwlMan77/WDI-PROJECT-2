"use strict";var Login=Login||{},google=google,apiUrl=window.location.origin+"/api",mapStyle=[{featureType:"all",elementType:"labels",stylers:[{visibility:"on"}]},{featureType:"all",elementType:"labels.text.fill",stylers:[{saturation:36},{color:"#000000"},{lightness:40}]},{featureType:"all",elementType:"labels.text.stroke",stylers:[{visibility:"on"},{color:"#000000"},{lightness:16}]},{featureType:"all",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"administrative",elementType:"geometry.fill",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"administrative",elementType:"geometry.stroke",stylers:[{color:"#000000"},{lightness:17},{weight:1.2}]},{featureType:"administrative.country",elementType:"labels.text.fill",stylers:[{color:"#e5c163"}]},{featureType:"administrative.locality",elementType:"labels.text.fill",stylers:[{color:"#c4c4c4"}]},{featureType:"administrative.neighborhood",elementType:"labels.text.fill",stylers:[{color:"#e5c163"}]},{featureType:"landscape",elementType:"geometry",stylers:[{color:"#000000"},{lightness:20}]},{featureType:"poi",elementType:"geometry",stylers:[{color:"#000000"},{lightness:21},{visibility:"on"}]},{featureType:"poi.business",elementType:"geometry",stylers:[{visibility:"on"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#f9c1c3"},{lightness:"0"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"road.highway",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.highway",elementType:"labels.text.stroke",stylers:[{color:"#e5c163"}]},{featureType:"road.arterial",elementType:"geometry",stylers:[{color:"#000000"},{lightness:18}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#575757"}]},{featureType:"road.arterial",elementType:"labels.text.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"labels.text.stroke",stylers:[{color:"#2c2c2c"}]},{featureType:"road.local",elementType:"geometry",stylers:[{color:"#000000"},{lightness:16}]},{featureType:"road.local",elementType:"labels.text.fill",stylers:[{color:"#999999"}]},{featureType:"transit",elementType:"geometry",stylers:[{color:"#000000"},{lightness:19}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#000000"},{lightness:17}]}];Login.init=function(){this.apiUrl=apiUrl,this.$main=$("main"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$(".addLocations").on("click",this.addLocations.bind(this)),$("body").on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState(),this.mapSetup()},Login.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),Login.getCurrentLocation()},Login.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show()},Login.register=function(e){e&&e.preventDefault(),$(".modal-content").html('\n    <div class="modal-header">\n      <h5 class="modal-title">Register</h5>\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    <div class="modal-body">\n      <form method="post" action="/register">\n        <div class="form-group">\n          <input class="form-control" type="text" name="user[username]" placeholder="Username">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="email" name="user[email]" placeholder="Email">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[password]" placeholder="Password">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="text" name="user[homePostcode]" placeholder="Home postcode">\n        </div>\n        <input class="btn btn-primary" type="submit" value="Register">\n      </form>\n    </div>\n  '),$(".modal").modal("show")},Login.login=function(e){e&&e.preventDefault(),$(".modal-content").html('\n      <div class="modal-header">\n        <h5 class="modal-title">Login</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <form method="post" action="/login">\n          <div class="form-group">\n            <input class="form-control" type="email" name="email" placeholder="Email">\n          </div>\n          <div class="form-group">\n            <input class="form-control" type="password" name="password" placeholder="Password">\n          </div>\n          <input class="btn btn-primary" type="submit" value="Login">\n        </form>\n      </div>\n  '),$(".modal").modal("show")},Login.addLocations=function(e){e&&e.preventDefault(),$(".modal-content").html('\n    <div class="modal-header">\n      <h5 class="modal-title">Add Locations</h5>\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    <div class="modal-body">\n      <form method="post" action="/locations">\n        <div class="form-group">\n          <input class="form-control" id="file" type="file" name="file" placeholder="Add JSON file">\n        </div>\n        <input class="btn btn-primary" type="submit" value="Add">\n      </form>\n    </div>\n  '),$(".modal").modal("show")},Login.logout=function(e){e.preventDefault(),this.loggedOutState(),this.removeToken()},Login.handleForm=function(e){e.preventDefault(),$(".modal").modal("hide");var t,o=""+Login.apiUrl+$(this).attr("action"),n=$(this).attr("method");return"/locations"===$(this).attr("action")?(t=new FormData,t.append("file",$("#file")[0].files[0]),$.ajax({url:o,method:n,data:t,beforeSend:Login.setRequestHeader.bind(Login),processData:!1,contentType:!1}).done(function(e){console.log(e)}).fail(function(e){console.log(e)})):(t=$(this).serialize(),Login.ajaxRequest(o,n,t,function(e){e.token&&Login.setToken(e.token),Login.loggedInState()}))},Login.ajaxRequest=function(e,t,o,n){return $.ajax({url:e,method:t,data:o,beforeSend:this.setRequestHeader.bind(this)}).done(n).fail(function(e){console.log(e)})},Login.setRequestHeader=function(e){var t="Bearer "+this.getToken();return e.setRequestHeader("Authorization",t)},Login.setToken=function(e){return window.localStorage.setItem("token",e)},Login.getToken=function(){return window.localStorage.getItem("token")},Login.removeToken=function(){return window.localStorage.clear()},Login.clearModal=function(){$("#registerModal").modal("hide"),$("#loginModal").modal("hide")},Login.mapSetup=function(){var e=document.getElementById("map-canvas"),t={zoom:13,center:new google.maps.LatLng(51.50364,(-.127625)),styles:mapStyle};Login.map=new google.maps.Map(e,t)},Login.getCurrentLocation=function(){navigator.geolocation.getCurrentPosition(function(e){var t={lat:e.coords.latitude,lng:e.coords.longitude};new google.maps.Marker({position:new google.maps.LatLng(t.lat,t.lng),map:Login.map,icon:"/images/jmSunglasses.png",animation:google.maps.Animation.DROP}),Login.getLocations()})},Login.getLocations=function(){console.log(apiUrl),$.get("api/locations").done(Login.createMarkersForLocations)},Login.createMarkersForLocations=function(e){$.each(e,function(e,t){var o=new google.maps.LatLng(t.latitudeE7/1e7,t.longitudeE7/1e7);new google.maps.Marker({position:o,map:Login.map,icon:"/images/marker.png"})})},Login.addInfoWindowForCamera=function(e,t){google.maps.event.addListener(t,"click",function(){console.log("clicked")})},$(Login.init.bind(Login));
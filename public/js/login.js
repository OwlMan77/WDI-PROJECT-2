"use strict";var Login=Login||{};Login.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),$("body").on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},Login.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide()},Login.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show()},Login.register=function(o){o&&o.preventDefault(),$(".modal-content").html('\n    <div class="modal-header">\n      <h5 class="modal-title">Register</h5>\n      <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    <div class="modal-body">\n      <form method="post" action="/register">\n        <div class="form-group">\n          <input class="form-control" type="text" name="user[username]" placeholder="Username">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="email" name="user[email]" placeholder="Email">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[password]" placeholder="Password">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="text" name="user[homePostcode]" placeholder="Home postcode">\n        </div>\n        <input class="btn btn-primary" type="submit" value="Register">\n      </form>\n    </div>\n  '),$(".modal").modal("show")},Login.login=function(o){o&&o.preventDefault(),$(".modal-content").html('\n      <div class="modal-header">\n        <h5 class="modal-title">Login</h5>\n        <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n          <span aria-hidden="true">&times;</span>\n        </button>\n      </div>\n      <div class="modal-body">\n        <form method="post" action="/login">\n          <div class="form-group">\n            <input class="form-control" type="email" name="email" placeholder="Email">\n          </div>\n          <div class="form-group">\n            <input class="form-control" type="password" name="password" placeholder="Password">\n          </div>\n          <input class="btn btn-primary" type="submit" value="Login">\n        </form>\n      </div>\n  '),$(".modal").modal("show")},Login.logout=function(o){o.preventDefault(),this.loggedOutState(),this.removeToken()},Login.handleForm=function(o){console.log("running"),o.preventDefault();var n=""+Login.apiUrl+$(this).attr("action"),t=$(this).attr("method"),e=$(this).serialize();return Login.ajaxRequest(n,t,e,function(o){o.token&&Login.setToken(o.token),Login.loggedInState()})},Login.ajaxRequest=function(o,n,t,e){return $.ajax({url:o,method:n,data:t,beforeSend:this.setRequestHeader.bind(this)}).done(e).fail(function(o){console.log(o)})},Login.setRequestHeader=function(o){return o.setRequestHeader("Authorization","Bearer "+this.getToken())},Login.setToken=function(o){return window.localStorage.setItem("token",o)},Login.getToken=function(){return window.localStorage.getItem("token")},Login.removeToken=function(){return window.localStorage.clear()},Login.clearModal=function(){$("#registerModal").modal("hide"),$("#loginModal").modal("hide")},$(Login.init.bind(Login));
"use strict";var Login=Login||{};Login.init=function(){this.apiUrl="http://localhost:3000/api",this.$main=$("main"),$(".register").on("click",this.register.bind(this)),$(".login").on("click",this.login.bind(this)),$(".logout").on("click",this.logout.bind(this)),this.$main.on("submit","form",this.handleForm),this.getToken()?this.loggedInState():this.loggedOutState()},Login.loggedInState=function(){$(".loggedIn").show(),$(".loggedOut").hide(),this.$main.html("")},Login.loggedOutState=function(){$(".loggedIn").hide(),$(".loggedOut").show()},Login.register=function(n){n&&n.preventDefault(),this.$main.html('\n      <form method="post" action="/register">\n        <div class="form-group">\n          <input class="form-control" type="text" name="user[username]" placeholder="Username">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="email" name="user[email]" placeholder="Email">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[password]" placeholder="Password">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="password" name="user[passwordConfirmation]" placeholder="Password Confirmation">\n        </div>\n        <div class="form-group">\n          <input class="form-control" type="text" name="user[homePostcode]" placeholder="Home postcode">\n        </div>\n        <input class="btn btn-primary" type="submit" value="Register">\n      </form>\n    ')},Login.login=function(n){n.preventDefault(),this.$main.html('\n  <form method="post" action="/login">\n  <div class="form-group">\n    <input class="form-control" type="email" name="email" placeholder="Email">\n  </div>\n  <div class="form-group">\n    <input class="form-control" type="password" name="password" placeholder="Password">\n  </div>\n  <input class="btn btn-primary" type="submit" value="Login">\n</form>\n    ')},Login.logout=function(n){n.preventDefault(),this.loggedOutState(),this.removeToken()},Login.handleForm=function(n){n.preventDefault();var o=""+Login.apiUrl+$(this).attr("action"),t=$(this).attr("method"),e=$(this).serialize();return Login.ajaxRequest(o,t,e,function(n){n.token&&Login.setToken(n.token),Login.loggedInState()})},Login.ajaxRequest=function(n,o,t,e){return $.ajax({url:n,method:o,data:t,beforeSend:this.setRequestHeader.bind(this)}).done(e).fail(function(n){console.log(n)})},Login.setRequestHeader=function(n){return n.setRequestHeader("Authorization","Bearer "+this.getToken())},Login.setToken=function(n){return window.localStorage.setItem("token",n)},Login.getToken=function(){return window.localStorage.getItem("token")},Login.removeToken=function(){return window.localStorage.clear()},$(Login.init.bind(Login));